# How to Update and Maintain the Base Environment

**Version:** 1.0 (October 2025)
**Related Files:** `setup_base_env.sh`, `README_setup_base_env.md`

## Overview

This guide provides a comprehensive, reusable prompt for adding packages and maintaining the sophisticated data science environment. Use this every time you need to update the environment to ensure consistency with the smart constraints and conflict resolution system.

---

## ðŸ”„ Environment Update & Package Management Prompt

**Copy and use this prompt with Claude Code when updating the environment:**

```
I need to add/update packages in my comprehensive data science environment and ensure everything is current and conflict-free.

PACKAGES TO ADD/UPDATE:
- [package1]
- [package2]
- [package3]

REQUIREMENTS:
1. Work 100% consistently with the sophisticated smart constraints and conflict resolution system documented in @README_setup_base_env.md

2. VERIFICATION & TESTING:
   - Check if packages already exist in base-env/requirements.in
   - Verify current installation status in base-env/.venv
   - Run setup_base_env.sh with --adaptive flag for intelligent conflict resolution
   - Test each new/updated package installation and basic functionality
   - Check for package conflicts using pip check
   - Document any conflicts found (breaking vs. non-breaking)
   - **CRITICAL: Check if old conflicts are now resolvable:**
     * Try upgrading packages with known conflicts to latest versions
     * Verify if smart constraints can be relaxed with newer package versions
     * Document investigation results even if conflicts remain unresolvable
     * Preserve working state - revert if new versions create more conflicts

3. ENVIRONMENT UPDATES:
   - Add new packages to appropriate category in base-env/requirements.in
   - Use smart constraints for known problematic packages
   - If compatibility issues arise (like pip/pip-tools), fix in setup_base_env.sh with clear comments
   - Preserve all performance optimizations (caching, wheel pre-compilation, early exit)
   - Maintain backtracking prevention for known problematic packages

4. DOCUMENTATION:
   - Update README_setup_base_env.md if:
     * New package categories added
     * New smart constraints applied
     * Performance optimizations changed
     * Installation requirements changed
   - Document any new version pinning or compatibility fixes
   - Update package counts if changed

5. GIT & GITHUB (CRITICAL):
   - Repository: https://github.com/davidlary/SetUpEnvironments.git
   - Commit changes to both base-env/ and parent Environments/ directories
   - Use descriptive commit messages following the format:
     ```
     [Action]: [Brief description]

     Changes:
     - Bullet point list

     Verified [package] installation and functionality.

     ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

     Co-Authored-By: Claude <noreply@anthropic.com>
     ```
   - Handle merge conflicts by preserving local sophisticated system features
   - Push to origin main

6. FINAL VERIFICATION:
   - Confirm all new packages import successfully
   - Run final pip check and report results
   - Verify README is up to date
   - Confirm git push succeeded
   - Provide summary of changes

GITHUB CREDENTIALS:
- Use environment variables: $GITHUB_TOKEN, $GITHUB_EMAIL, $GITHUB_USERNAME
- Repository: SetUpEnvironments (NOT base-env)

Please follow this process systematically, using the TodoWrite tool to track progress through each phase.
```

---

## ðŸ“‹ Quick Reference: Key Files

| File | Purpose | When to Update |
|------|---------|----------------|
| `base-env/requirements.in` | Human-maintained package list | Always (when adding/removing packages) |
| `base-env/requirements.txt` | Auto-generated pinned versions | Auto-generated by pip-compile |
| `setup_base_env.sh` | Main setup script | Only if compatibility issues or new features |
| `README_setup_base_env.md` | Main documentation | When features/requirements/counts change |
| `base-env/.gitignore` | Base-env git exclusions | Rarely (new cache dirs, etc.) |
| `.gitignore` (parent) | Parent directory exclusions | Rarely (new sensitive files) |

---

## ðŸŽ¯ Example Usage Scenarios

### Scenario 1: Adding New Packages

**Prompt:**
```
I need to add/update packages in my comprehensive data science environment and ensure everything is current and conflict-free.

PACKAGES TO ADD/UPDATE:
- tensorflow
- keras
- torch

[Rest of prompt from above...]
```

### Scenario 2: Checking for Updates and Conflicts

**Prompt:**
```
I need to add/update packages in my comprehensive data science environment and ensure everything is current and conflict-free.

PACKAGES TO ADD/UPDATE:
- No new packages, just check all existing packages are up to date and resolve any conflicts

[Rest of prompt from above...]
```

### Scenario 3: Updating Specific Package Versions

**Prompt:**
```
I need to add/update packages in my comprehensive data science environment and ensure everything is current and conflict-free.

PACKAGES TO ADD/UPDATE:
- numpy>=2.0.0 (upgrade from current version)
- pandas>=2.2.0 (upgrade from current version)

[Rest of prompt from above...]
```

### Scenario 4: Checking for Latest Versions with Update Mode

**Command:**
```bash
cd /path/to/your/environments/directory
./setup_base_env.sh --update
```

**What this does:**
- Automatically checks all packages for latest versions
- Tests if old conflicts (like protobuf) have been resolved
- Creates temporary test environment to verify compatibility
- Compares current vs. latest versions for all smart constraint packages
- Offers to apply updates if no conflicts found (with 10-second timeout)
- Restores original configuration if conflicts are detected
- Automatically enables adaptive mode for intelligent conflict resolution

**When to use:**
- Monthly or quarterly maintenance
- Before starting new projects
- After major package updates are announced
- When you suspect old conflicts might be resolved with newer versions

**Expected output:**
```
ðŸ”„ UPDATE MODE: Checking for latest package versions and conflict resolution...
===============================================================================
ðŸ“ Creating temporary requirements file with relaxed constraints...
ðŸ” Testing latest available versions...
âœ… Successfully compiled with relaxed constraints

ðŸ“Š VERSION COMPARISON:
--------------------
  ðŸ“¦ numpy: 1.20.0 â†’ 2.1.0 (update available)
  âœ… ipywidgets: 8.1.7 (already latest)
  ðŸ“¦ plotly: 5.15.0 â†’ 5.24.1 (update available)
  ...

ðŸ§ª Testing for conflicts with latest versions...
âœ… No conflicts detected with latest versions!

ðŸ’¡ Recommendation: Latest versions appear to be compatible.
   Consider updating smart constraints in requirements.in

â“ Apply these updates? (will update requirements.in with latest versions)
   Press Ctrl+C to cancel, or wait 10 seconds to apply...
```

---

## âš ï¸ Important Reminders

### Repository Configuration
- **Correct repository:** `https://github.com/davidlary/SetUpEnvironments.git`
- **NOT:** `https://github.com/davidlary/base-env.git`
- The setup script has been updated to use the correct URL

### Sophisticated System Features to Preserve

1. **Smart Constraints (8 packages)**
   - numpy>=1.20.0 (minimum version for scientific computing)
   - ipywidgets==8.1.7 (Jupyter widget compatibility)
   - geemap==0.36.4 (Google Earth Engine API compatibility)
   - plotly==5.15.0 (v6+ has breaking changes)
   - panel==1.8.2 (dashboard framework stability)
   - bokeh==3.8.0 (historical stability issues)
   - voila==0.5.11 (web app conversion stability)
   - selenium==4.36.0 (browser automation latest stable)

2. **Performance Optimizations**
   - Early exit detection
   - Smart filtering
   - Wheel pre-compilation
   - Pip caching
   - Pip version pinning (pip < 25.2)

3. **Conflict Resolution**
   - Two-tier strategy (Fast/Adaptive)
   - Backtracking prevention
   - Dynamic resolver with 4 strategies

### Common Issues and Solutions

#### Issue: pip-tools compatibility error
**Solution:** Ensure `pip < 25.2` is pinned in setup_base_env.sh (line 316)

#### Issue: Merge conflicts when pushing
**Solution:** Always preserve local sophisticated system features:
```bash
git checkout --ours setup_base_env.sh .gitignore
git checkout --theirs [files from remote]
```

#### Issue: Package conflicts detected
**Solution:**
1. Run with `--adaptive` flag first
2. If unresolved, add smart constraint to requirements.in
3. Document in README if it's a new known issue

---

## ðŸ” Verification Checklist

Before considering the update complete, verify:

- [ ] All new packages listed in requirements.in
- [ ] setup_base_env.sh ran successfully with --adaptive
- [ ] All new packages import successfully in Python
- [ ] pip check results documented (conflicts OK if non-breaking)
- [ ] README_setup_base_env.md updated if needed
- [ ] Changes committed to git with proper format
- [ ] Changes pushed to SetUpEnvironments repository
- [ ] Summary provided with all changes listed

---

## ðŸ“š Related Documentation

- **Main Setup Guide:** `README_setup_base_env.md`
- **API Key Management:** `README.API-KEYS.md`
- **Security Guidelines:** `SECURITY_AND_PRIVACY.md`
- **Setup Script:** `setup_base_env.sh`

---

**Last Updated:** October 25, 2025
**Maintained by:** David Lary
**Environment Version:** 3.0
